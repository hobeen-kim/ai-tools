---
name: git-commit
description: 이 저장소에서 git 커밋/푸시를 수행할 때의 표준 절차. 변경사항 점검, (가능하면) 빌드/테스트 검증, 안전한 스테이징, 커밋 메시지 작성, 비대화형 커밋 실행, 그리고 사용자가 요청한 경우에만 푸시까지 수행한다.
---

# Git 커밋/푸시 워크플로우

이 스킬은 “커밋해줘”, “커밋 메시지 써줘”, “푸시해줘” 같은 요청이 있을 때 사용한다.

## 1) 작업 범위 확인(필수)

1. `git status --short`로 변경/추가 파일을 확인한다.
2. `git diff` / `git diff --staged`로 커밋에 들어갈 변경을 읽고, 커밋 범위를 확정한다.
3. `git log -5 --oneline`로 기존 커밋 메시지 스타일이 있으면 따른다(없으면 아래 기본 형식 사용).
4. 비밀값 가능성이 있는 파일(`.env`, 키/토큰/인증서, credentials 등)이 섞였는지 확인하고, 포함되면 커밋하지 않는다.

## 2) 커밋 전 검증(가능하면)

1. 저장소에 정의된 빌드/테스트/린트 명령이 있으면 실행한다(예: `Makefile`, `package.json` scripts, `pyproject.toml`, `go test ./...` 등).
2. 실패하면 원인/로그 핵심만 요약하고 커밋을 중단한다.
3. 사용자가 “검증 없이 커밋”을 명시한 경우에만, 검증을 생략했다고 결과에 기록한다.

## 3) 스테이징(필수)

1. 커밋 대상 파일만 `git add <path>`로 스테이징한다.
2. 범위가 명확할 때만 `git add .`를 사용한다.
3. `git status --short`로 스테이징 결과를 재확인한다.

## 4) 커밋 메시지 작성(필수)

기본 형식(저장소에 기존 스타일이 없을 때):

```text
<type>: <요약>

- 변경 1 (왜/의도 중심)
- 변경 2
```

규칙:

- `type`: `feat`, `fix`, `chore`, `docs`, `refactor`, `test` 중 성격에 맞게 선택한다.
- 제목/본문은 한국어로 작성한다(저장소 관례가 다르면 그 관례 우선).
- 본문은 실제 반영된 변경만 bullet로 작성한다.
- 이슈 번호가 명확히 연결되어 있으면 제목 끝에 `#123` 형태로 포함한다.

## 5) 커밋 실행(필수)

1. 비대화형으로 커밋한다.
2. 성공 시 `git status`로 상태를 확인하고, 커밋 해시/제목을 사용자에게 공유한다.

예시:

```bash
git commit -m "feat: Postgres MCP 추가 #123" \
  -m "- mcp/postgres Dockerfile 및 서버 구현" \
  -m "- OpenCode 설정 예시 문서화"
```

## 6) 푸시(사용자 요청 시에만)

1. 현재 브랜치와 upstream을 확인한다: `git status -sb`
2. upstream이 없으면 설정하며 푸시한다: `git push -u origin HEAD`
3. upstream이 있으면 일반 푸시한다: `git push`

주의:

- `git push --force`(또는 `--force-with-lease`)는 사용자가 명시적으로 요청하지 않으면 금지.
- `main`/`master`로 직접 푸시가 위험한 레포라면, 사용자가 명시적으로 요청한 경우에만 수행.

## 7) 안전 규칙(필수)

1. 사용자가 요청하지 않은 파일은 커밋에 포함하지 않는다.
2. 대화형 git 명령(`git commit` 단독, `git add -p`)보다 비대화형 명령을 우선한다.
3. 기존에 존재하던 사용자 변경사항은 되돌리지 않는다.
4. git 설정 변경, 강제 푸시, 파괴적 명령(`reset --hard` 등)은 하지 않는다.
